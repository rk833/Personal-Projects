{% extends "base.html" %} {% block title %}My Profile{% endblock %} 

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/profile.css') }}">
{% endblock %}

{% block content %}
<!-- Profile Container -->
<div class="container profile-container">
  <div class="row">

    <div class="col-md-4">
      <div class="card mb-4">
        <div class="card-body text-center">
          <div class="mb-3">
            <i class="fas fa-user-circle fa-5x text-primary"></i>
          </div>
          <h4>{{ user.first_name }} {{ user.last_name }}</h4>
          <p class="text-muted">
            Member since {{ user.created_at.strftime('%B %Y') }}
          </p>
          <div class="mt-3">
            <p><strong>Total Bookings:</strong> {{ user.total_bookings }}</p>
            <p>
              <strong>Total Spent:</strong> £{{ "%.2f"|format(user.total_spent
              or 0) }}
            </p>
          </div>
        </div>
      </div>
    </div>

  <!-- Profile Update Form -->
    <div class="col-md-8">
      <div class="card mb-4">
        <div class="card-body">
          <h5 class="card-title">Update Profile</h5>
          <form action="{{ url_for('profile') }}" method="POST">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
            <input type="hidden" name="action" value="update_profile" />
            <div class="row">
              <div class="col-md-6 mb-3">
                <label class="form-label">First Name</label>
                <input
                  type="text"
                  name="first_name"
                  class="form-control"
                  value="{{ user.first_name }}"
                  required
                />
              </div>
              <div class="col-md-6 mb-3">
                <label class="form-label">Last Name</label>
                <input
                  type="text"
                  name="last_name"
                  class="form-control"
                  value="{{ user.last_name }}"
                  required
                />
              </div>
            </div>
            <div class="mb-3">
              <label class="form-label">Email</label>
              <input
                type="email"
                class="form-control"
                value="{{ user.email }}"
                readonly
              />
              <small class="text-muted">Email cannot be changed</small>
            </div>
            <div class="mb-3">
              <label class="form-label">Phone</label>
              <input
                type="tel"
                name="phone"
                class="form-control"
                value="{{ user.phone }}"
              />
            </div>
            <button type="submit" class="btn btn-primary">
              Update Profile
            </button>
          </form>
        </div>
      </div>

      <!-- Password Change Form -->
      <div class="card">
        <div class="card-body">
          <h5 class="card-title">Change Password</h5>
          <form action="{{ url_for('profile') }}" method="POST">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
            <input type="hidden" name="action" value="change_password" />
            <div class="mb-3">
              <label class="form-label">Current Password</label>
              <div class="input-group">
                <input
                  type="password"
                  name="current_password"
                  class="form-control"
                  required
                  id="current_password"
                />
                <button
                  class="btn btn-outline-secondary"
                  type="button"
                  id="toggleCurrentPassword"
                >
                  <i class="fas fa-eye"></i>
                </button>
              </div>
            </div>
            <div class="mb-3">
              <label class="form-label">New Password</label>
              <div class="input-group">
                <input
                  type="password"
                  name="new_password"
                  class="form-control"
                  required
                  minlength="8"
                  id="new_password"
                />
                <button
                  class="btn btn-outline-secondary"
                  type="button"
                  id="toggleNewPassword"
                >
                  <i class="fas fa-eye"></i>
                </button>
              </div>
            </div>
            <div class="mb-3">
              <label class="form-label">Confirm New Password</label>
              <div class="input-group">
                <input
                  type="password"
                  name="confirm_password"
                  class="form-control"
                  required
                  minlength="8"
                  id="confirm_password"
                />
                <button
                  class="btn btn-outline-secondary"
                  type="button"
                  id="toggleConfirmPassword"
                >
                  <i class="fas fa-eye"></i>
                </button>
              </div>
            </div>
            <button type="submit" class="btn btn-primary">
              Change Password
            </button>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>
<!-- Back to Top Button -->
<button id="back-to-top" title="Go to top">↑</button>

{% endblock %} {% block extra_js %}
<script src="{{ url_for('static', filename='js/main.js') }}"></script>
<script src="{{ url_for('static', filename='js/profile.js') }}"></script>

<script>
  function togglePasswordVisibility(inputId, buttonId) {
    const input = document.getElementById(inputId);
    const button = document.getElementById(buttonId);
    const icon = button.querySelector("i");

    button.addEventListener("click", function () {
      if (input.type === "password") {
        input.type = "text";
        icon.classList.remove("fa-eye");
        icon.classList.add("fa-eye-slash");
      } else {
        input.type = "password";
        icon.classList.remove("fa-eye-slash");
        icon.classList.add("fa-eye");
      }
    });
  }

  // Initialize password toggles
  document.addEventListener("DOMContentLoaded", function () {
    togglePasswordVisibility("current_password", "toggleCurrentPassword");
    togglePasswordVisibility("new_password", "toggleNewPassword");
    togglePasswordVisibility("confirm_password", "toggleConfirmPassword");
  });
</script>

{% endblock %}
